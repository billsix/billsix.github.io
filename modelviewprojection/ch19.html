<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lambda Stack - Demo 19 &mdash; Model View Projection 0.0.1 documentation</title>
      <link rel="stylesheet" href="static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="static/css/my_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="static/documentation_options.js"></script>
        <script src="static/jquery.js"></script>
        <script src="static/underscore.js"></script>
        <script src="static/doctools.js"></script>
    <script src="static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Matrix Stacks - Demo 20" href="ch20.html" />
    <link rel="prev" title="3D Perspective - Demo 18" href="ch18.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Model View Projection
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch01.html">Opening a Window - Demo 01</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch02.html">Draw A Rectange - Demo 02</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch03.html">Window Resizing and Proportionality - Demo 03</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch04.html">Moving the Paddles - Keyboard Input - Demo 04</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch05.html">Add Translate Method to Vertex - Demo 05</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch06.html">Modelspace - Demo 06</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch07.html">Rotations - Demo 07</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch08.html">Rotation Fix Attempt 1 - Demo 08</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch09.html">Rotation Fixed - Sequence of Transforamations - Demo 09</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch10.html">Camera Space - Demo 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch11.html">Relative Objects - Demo 11</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch12.html">Rotate the Square - Demo 12</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch13.html">Rotate the Square Around Paddle 1 - Demo 13</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch14.html">Adding Depth - Z axis Demo 14</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch15.html">Adding Depth - Enable Depth Buffer - Demo 15</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch16.html">Moving Camera in 3D Space - Demo 16</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch17.html">Game Controller - Demo 17</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch18.html">3D Perspective - Demo 18</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lambda Stack - Demo 19</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-execute">How to Execute</a></li>
<li class="toctree-l2"><a class="reference internal" href="#move-the-paddles-using-the-keyboard">Move the Paddles using the Keyboard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#event-loop">Event Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#draw-paddle-1">draw paddle 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#draw-the-square">draw the square</a></li>
<li class="toctree-l3"><a class="reference internal" href="#draw-paddle-2">draw paddle 2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ch20.html">Matrix Stacks - Demo 20</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Model View Projection</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Lambda Stack - Demo 19</li>
      <li class="wy-breadcrumbs-aside">
            <a href="sources/ch19.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lambda-stack-demo-19">
<h1>Lambda Stack - Demo 19<a class="headerlink" href="#lambda-stack-demo-19" title="Permalink to this headline">¶</a></h1>
<section id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>Remove repetition in the coordinate transformations,
as previous demos had very similar transformtions,
especially from camera space to NDC space.
Each node in the tree of the graph of objects (../images/demo11.png)
should only be specified once.</p>
<p>Noticing in the previous demos that the lower parts of the transformations
have a common pattern, we can create a stack of functions for later application.
Before drawing geometry, we add any functions to the top of the stack,
apply all of our functions in the stack to our modelspace data to
get NDC data,
and before we return to the parent
node, we pop the functions we added off of the stack, to ensure that
we return the stack to the state that the parent node gave us.</p>
<p>To explain in more detail —</p>
<p>What’s the difference between drawing paddle 1 and the square?</p>
<p>Here is paddle 1 code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">305</span>    <span class="n">time_at_beginning_of_previous_frame</span> <span class="o">=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
<span class="linenos">306</span>
<span class="linenos">307</span>    <span class="n">glfw</span><span class="o">.</span><span class="n">poll_events</span><span class="p">()</span>
<span class="linenos">308</span>
<span class="linenos">309</span>    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">get_framebuffer_size</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="linenos">310</span>    <span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="linenos">311</span>    <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>
<span class="linenos">312</span>
<span class="linenos">313</span>    <span class="n">draw_in_square_viewport</span><span class="p">()</span>
<span class="linenos">314</span>    <span class="n">handle_inputs</span><span class="p">()</span>
<span class="linenos">315</span>
<span class="linenos">316</span>    <span class="n">axes_list</span> <span class="o">=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">get_joystick_axes</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">JOYSTICK_1</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the square’s code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">320</span>            <span class="n">camera</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span>
<span class="linenos">321</span>        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">0.19</span><span class="p">:</span>
<span class="linenos">322</span>            <span class="n">camera</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span>
<span class="linenos">323</span>            <span class="n">camera</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span>
<span class="linenos">324</span>
<span class="linenos">325</span>        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.19</span><span class="p">:</span>
<span class="linenos">326</span>            <span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span> <span class="o">-=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">327</span>        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.19</span><span class="p">:</span>
<span class="linenos">328</span>            <span class="n">camera</span><span class="o">.</span><span class="n">rot_x</span> <span class="o">+=</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">329</span>
<span class="linenos">330</span>    <span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">camera_space_to_ndc_space_fn</span><span class="p">())</span>  <span class="c1"># (1)</span>
<span class="linenos">331</span>
<span class="linenos">332</span>    <span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">rotate_x</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_x</span><span class="p">))</span>  <span class="c1"># (2)</span>
<span class="linenos">333</span>    <span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">rotate_y</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">))</span>  <span class="c1"># (3)</span>
<span class="linenos">334</span>    <span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</pre></div>
</div>
<p>The only difference is the square’s model-space to paddle1 space.
In a graphics program, because the scene is a hierarchy of relative
objects, it’s unwise to put this much repetition in the transformation
sequence.  Especially if we might change how the camera operates,
or from perspective to ortho.  It would required a lot of code changes.
And I don’t like reading from the bottom of the code up.  Code doesn’t
execute that way.  I want to read from top to bottom.</p>
<p>When reading the transformation sequences from top down
the transformation at the top is applied first, the transformation
at the bottom is applied last, with the intermediate results method-chained together.
(look up above for a reminder)</p>
<blockquote>
<div><p>With a function stack, the function at the top of the stack (f5) is applied first,
the result of this is then given as input to f4 (second on the stack), all
the way down to f1, which was the first fn to be placed on the stack,
and as such, the last to be applied. (Last In First Applied - LIFA)</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>             <span class="o">|-------------------|</span>
<span class="p">(</span><span class="n">MODELSPACE</span><span class="p">)</span> <span class="o">|</span>                   <span class="o">|</span>
  <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="o">-&gt;</span>  <span class="o">|</span>       <span class="n">f5</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f4</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f3</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f2</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f1</span>          <span class="o">|--&gt;</span>  <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="n">NDC</span>
             <span class="o">|-------------------|</span>
</pre></div>
</div>
<p>So, in order to ensure that the functions in a stack will execute
in the same order as all of the previous demos, they need to
push as in reverse order</p>
<p>This means that from modelspace to world space, we can now
read the transformations FROM TOP TO BOTTOM (lexigraphically).  YEAH!!!!</p>
<p># FUNCTION STACKS FTW!!!!!!!!!!  (I use function stacks to attempt to
#                                 transition to matricies, without having
#                                 to cover linear algebra material.  Matrix
#                                 stacks will be used in the same way
#                                 as this function stack is)
#</p>
<p>Then, to draw the square relative to paddle one, those six
transformations will already be on the stack, therefore
only push the differences, and then apply the stack to
the paddle’s modelspace data</p>
<p>Here is the square’s code:
# for model_space in square:
#     paddle_1_space = model_space.rotate_z(square_rotation)             push this eleventh
#                                 .translate(tx=20.0, ty=0.0, tz=0.0)    push this tenth
#                                 .rotate_z(rotation_around_paddle1)     push this ninth
#                                 .translate(tx=0.0,                       push this eigth
#                                            ty=0.0,
#                                            tz=-10.0)
#     world_space = paddle_1_space.rotate_z(paddle1.rotation)             (nothing to push here or below,
#                                 .translate(tx=paddle1.position.x, as they are already on the stack
#                                            ty=paddle1.position.y,
#                                            tz=0.0)
#      camera_space = world_space.translate(tx=-moving_camera_x,
#                                          ty=-moving_camera_y,
#                                          tz=-moving_camera_z) #                               .rotate_y( -moving_camera_rot_y) #                               .rotate_x( -moving_camera_rot_x)
#     ndc_space = camera_space.camera_space_to_ndc_space_fn()
#     glVertex3f(ndc_space.x,
#                ndc_space.y,
#                ndc_space.z)</p>
<p>when we have drawn the blue square, we are done drawing from
this part of the tree, and need to go back up to world space</p>
<figure class="align-center" id="id1">
<img alt="Demo 18" src="images/demo111.png" />
<figcaption>
<p><span class="caption-text">Demo 18</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Therefore, we just need to pop off the correct number of
functions, to just leave worldspace-&gt;cameraspace-&gt;ndc.
Effectively, the following computation is all that
will remain on the matrix stack.</p>
<p>#      camera_space = world_space.translate(tx=-moving_camera_x,
#                                          ty=-moving_camera_y,
#                                          tz=-moving_camera_z) #                               .rotate_y( -moving_camera_rot_y) #                               .rotate_x( -moving_camera_rot_x)
#     ndc_space = camera_space.camera_space_to_ndc_space_fn()</p>
<p>We can then push the transformations from world space to
paddle2 space, shown below.  Search for NEW to find the NEW CODE</p>
</section>
<section id="how-to-execute">
<h2>How to Execute<a class="headerlink" href="#how-to-execute" title="Permalink to this headline">¶</a></h2>
<p>On Linux or on MacOS, in a command prompt, type “python src/demo19/demo.py”.
On Windows, in a command prompt, type “python src\demo19\demo.py”.</p>
</section>
<section id="move-the-paddles-using-the-keyboard">
<h2>Move the Paddles using the Keyboard<a class="headerlink" href="#move-the-paddles-using-the-keyboard" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyboard Input</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>w</em></p></td>
<td><p>Move Left Paddle Up</p></td>
</tr>
<tr class="row-odd"><td><p><em>s</em></p></td>
<td><p>Move Left Paddle Down</p></td>
</tr>
<tr class="row-even"><td><p><em>k</em></p></td>
<td><p>Move Right Paddle Down</p></td>
</tr>
<tr class="row-odd"><td><p><em>i</em></p></td>
<td><p>Move Right Paddle Up</p></td>
</tr>
<tr class="row-even"><td><p><em>d</em></p></td>
<td><p>Increase Left Paddle’s Rotation</p></td>
</tr>
<tr class="row-odd"><td><p><em>a</em></p></td>
<td><p>Decrease Left Paddle’s Rotation</p></td>
</tr>
<tr class="row-even"><td><p><em>l</em></p></td>
<td><p>Increase Right Paddle’s Rotation</p></td>
</tr>
<tr class="row-odd"><td><p><em>j</em></p></td>
<td><p>Decrease Right Paddle’s Rotation</p></td>
</tr>
<tr class="row-even"><td><p><em>UP</em></p></td>
<td><p>Move the camera up, moving the objects down</p></td>
</tr>
<tr class="row-odd"><td><p><em>DOWN</em></p></td>
<td><p>Move the camera down, moving the objects up</p></td>
</tr>
<tr class="row-even"><td><p><em>LEFT</em></p></td>
<td><p>Move the camera left, moving the objects right</p></td>
</tr>
<tr class="row-odd"><td><p><em>RIGHT</em></p></td>
<td><p>Move the camera right, moving the objects left</p></td>
</tr>
<tr class="row-even"><td><p><em>q</em></p></td>
<td><p>Rotate the square around it’s center</p></td>
</tr>
<tr class="row-odd"><td><p><em>e</em></p></td>
<td><p>Rotate the square around paddle 1’s center</p></td>
</tr>
</tbody>
</table>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>aoeutnhaeosnt</p>
<p>function stack.  The bottom of the stack has
the low index, the top of the stack has the highest
index</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">282</span>    <span class="k">if</span> <span class="n">glfw</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_J</span><span class="p">)</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span><span class="p">:</span>
</pre></div>
</div>
<p>Given an input vertex, apply the function at the top
of the stack to the vertex, capture the output vertex,
to be used as input to the next lower function on the
stack.  Continue doing this until we get the value
returned from the function at the bottom of the stack.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">284</span>    <span class="k">if</span> <span class="n">glfw</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="n">KEY_L</span><span class="p">)</span> <span class="o">==</span> <span class="n">glfw</span><span class="o">.</span><span class="n">PRESS</span><span class="p">:</span>
<span class="linenos">285</span>        <span class="n">paddle2</span><span class="o">.</span><span class="n">rotation</span> <span class="o">-=</span> <span class="mf">0.1</span>
<span class="linenos">286</span>
<span class="linenos">287</span>
<span class="linenos">288</span><span class="n">TARGET_FRAMERATE</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span>
</pre></div>
</div>
</section>
<section id="event-loop">
<h2>Event Loop<a class="headerlink" href="#event-loop" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">295</span>    <span class="p">):</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
</pre></div>
</div>
<p>In previous demos, camera_space_to_ndc_space_fn was always
the last function called by the computer.  put it on the bottom of the stack,
so that “apply_stack” calls this function last</p>
<p>“append” adds the function to the end of a list, where
we conisder the front of the list to be the bottom of the stack,
and the end of the list to be the top of the stack.</p>
<p>every object uses the same projection</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">312</span>            <span class="n">camera</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span>
</pre></div>
</div>
<p>Unlike in previous demos in which we read the transformations
from model space to world space backwards; because the transformations
are on a stack, the fns on the model stack can
be read forwards, where each operation translates/rotates/scales
the current space</p>
<p>The camera’s position and orientation are defined relative
to world space like so, read top to bottom:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">camera</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                                      <span class="n">ty</span><span class="o">=</span><span class="n">camera</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                                      <span class="n">tz</span><span class="o">=</span><span class="n">camera</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
<span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">rotate_y</span><span class="p">(</span> <span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">))</span>
<span class="n">fn_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">rotate_x</span><span class="p">(</span> <span class="n">camera</span><span class="o">.</span><span class="n">rot_x</span><span class="p">))</span>
</pre></div>
</div>
<p>But, since we are dealing with world-space to camera space,
they must be inverted by reversing the order, and negating
the arguments</p>
<p>Therefore the transformations to put the world space into
camera space are.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">314</span>            <span class="n">camera</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span>
<span class="linenos">315</span>            <span class="n">camera</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span>
<span class="linenos">316</span>
<span class="linenos">317</span>        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.19</span><span class="p">:</span>
<span class="linenos">318</span>            <span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span> <span class="o">-=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
</pre></div>
</div>
<section id="draw-paddle-1">
<h3>draw paddle 1<a class="headerlink" href="#draw-paddle-1" title="Permalink to this headline">¶</a></h3>
<p>Unlike in previous demos in which we read the transformations
from model space to world space backwards; because the transformations
are on a stack, the fns on the model stack can
be read forwards, where each operation translates/rotates/scales
the current space</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">320</span>            <span class="n">camera</span><span class="o">.</span><span class="n">rot_x</span> <span class="o">+=</span> <span class="n">axes_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.01</span>
<span class="linenos">321</span>
<span class="linenos">322</span>
<span class="linenos">323</span>
<span class="linenos">324</span>    <span class="c1"># draw paddle 1</span>
<span class="linenos">325</span>    <span class="n">glColor3f</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">paddle1</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">paddle1</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
<span class="linenos">326</span>
<span class="linenos">327</span>    <span class="n">glBegin</span><span class="p">(</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">328</span>    <span class="k">for</span> <span class="n">model_space</span> <span class="ow">in</span> <span class="n">paddle1</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<span class="linenos">329</span>        <span class="n">world_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">model_space</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span> \
<span class="linenos">330</span>                                         <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">331</span>        <span class="n">camera_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">world_space</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tz</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> \
<span class="linenos">332</span>                                          <span class="o">.</span><span class="n">rotate_y</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span> \
<span class="linenos">333</span>                                          <span class="o">.</span><span class="n">rotate_x</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_x</span><span class="p">)</span>
<span class="linenos">334</span>        <span class="n">ndc_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">camera_space</span><span class="o">.</span><span class="n">camera_space_to_ndc_space_fn</span><span class="p">()</span>
<span class="linenos">335</span>        <span class="n">glVertex3f</span><span class="p">(</span><span class="n">ndc_space</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ndc_space</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ndc_space</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="linenos">336</span>    <span class="n">glEnd</span><span class="p">()</span>
<span class="linenos">337</span>
</pre></div>
</div>
<p>for each of the modelspace coordinates, apply all
of the procedures on the stack from top to bottom
this results in coordinate data in NDC space,
which we can pass to glVertex3f</p>
</section>
<section id="draw-the-square">
<h3>draw the square<a class="headerlink" href="#draw-the-square" title="Permalink to this headline">¶</a></h3>
<p>since the modelstack is already in paddle1’s space,
and since the blue square is defined relative to paddle1,
just add the transformations relative to it
before the blue square is drawn.  Draw the square, and then
remove these 4 transformations from the stack (done below)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">339</span>
<span class="linenos">340</span>    <span class="n">glColor3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="linenos">341</span>    <span class="n">glBegin</span><span class="p">(</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">342</span>    <span class="k">for</span> <span class="n">model_space</span> <span class="ow">in</span> <span class="n">square</span><span class="p">:</span>
<span class="linenos">343</span>        <span class="n">paddle_1_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">model_space</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">square_rotation</span><span class="p">)</span> \
<span class="linenos">344</span>                                            <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> \
<span class="linenos">345</span>                                            <span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">rotation_around_paddle1</span><span class="p">)</span> \
<span class="linenos">346</span>                                            <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tz</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">)</span>
<span class="linenos">347</span>        <span class="n">world_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">paddle_1_space</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span> \
<span class="linenos">348</span>                                            <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">349</span>        <span class="n">camera_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">world_space</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tz</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> \
<span class="linenos">350</span>                                          <span class="o">.</span><span class="n">rotate_y</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span> \
</pre></div>
</div>
<p>Now we need to remove fns from the stack so that the
matrix stack would convert from world space to NDC.
This will allow us to just add the transformaions from
world space to paddle2 space on the stack.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">352</span>        <span class="n">ndc_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">camera_space</span><span class="o">.</span><span class="n">camera_space_to_ndc_space_fn</span><span class="p">()</span>
<span class="linenos">353</span>        <span class="n">glVertex3f</span><span class="p">(</span><span class="n">ndc_space</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ndc_space</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ndc_space</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="linenos">354</span>    <span class="n">glEnd</span><span class="p">()</span>
<span class="linenos">355</span>
<span class="linenos">356</span>    <span class="c1"># draw paddle 2</span>
<span class="linenos">357</span>    <span class="n">glColor3f</span><span class="p">(</span><span class="n">paddle2</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="n">paddle2</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="n">paddle2</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>since paddle2’s model_space is independent of paddle 1’s space, only
leave the view and projection fns (1) - (4)</p>
</section>
<section id="draw-paddle-2">
<h3>draw paddle 2<a class="headerlink" href="#draw-paddle-2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">360</span>    <span class="k">for</span> <span class="n">model_space</span> <span class="ow">in</span> <span class="n">paddle2</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<span class="linenos">361</span>        <span class="n">world_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">model_space</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle2</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span> \
<span class="linenos">362</span>                                         <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="n">paddle2</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="o">=</span><span class="n">paddle2</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="linenos">363</span>        <span class="n">camera_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">world_space</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tx</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ty</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tz</span><span class="o">=-</span><span class="n">camera</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> \
<span class="linenos">364</span>                                          <span class="o">.</span><span class="n">rotate_y</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_y</span><span class="p">)</span> \
<span class="linenos">365</span>                                          <span class="o">.</span><span class="n">rotate_x</span><span class="p">(</span><span class="o">-</span><span class="n">camera</span><span class="o">.</span><span class="n">rot_x</span><span class="p">)</span>
<span class="linenos">366</span>        <span class="n">ndc_space</span><span class="p">:</span> <span class="n">Vertex</span> <span class="o">=</span> <span class="n">camera_space</span><span class="o">.</span><span class="n">camera_space_to_ndc_space_fn</span><span class="p">()</span>
<span class="linenos">367</span>        <span class="n">glVertex3f</span><span class="p">(</span><span class="n">ndc_space</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ndc_space</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ndc_space</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="linenos">368</span>    <span class="n">glEnd</span><span class="p">()</span>
<span class="linenos">369</span>
<span class="linenos">370</span>    <span class="n">glfw</span><span class="o">.</span><span class="n">swap_buffers</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="linenos">371</span>
<span class="linenos">372</span><span class="n">glfw</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</pre></div>
</div>
<p>remove all fns from the function stack, as the next frame will set them
clear makes the list empty, as the list (stack) will be repopulated
the next iteration of the event loop.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ch18.html" class="btn btn-neutral float-left" title="3D Perspective - Demo 18" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ch20.html" class="btn btn-neutral float-right" title="Matrix Stacks - Demo 20" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, William Emerison Six.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>