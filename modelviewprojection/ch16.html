<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="Moving Camera in 3D Space - Demo 17" href="ch17.html"><link rel="prev" title="Adding Depth - Enable Depth Buffer - Demo 15" href="ch15.html">

    <!-- Generated with Sphinx 8.1.3 and Furo 2025.09.25 -->
        <title>Lambda Stack - Demo 16 - Model View Projection 0.0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="static/pygments.css?v=acfd86a5" />
    <link rel="stylesheet" type="text/css" href="static/styles/furo.css?v=50c23ec3" />
    <link rel="stylesheet" type="text/css" href="static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="static/custom.css?v=b6a38b70" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Model View Projection 0.0.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <span class="sidebar-brand-text">Model View Projection 0.0.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch01.html">Opening a Window - Demo 01</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch02.html">Draw A Rectangle - Demo 02</a></li>
<li class="toctree-l1"><a class="reference internal" href="mathhomework1.html">Math Homework #1</a></li>
<li class="toctree-l1"><a class="reference internal" href="programmingproj1.html">Programming Project #1</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch03.html">Window Resizing and Proportionality - Demo 03</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch04.html">Moving the Paddles - Keyboard Input - Demo 04</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch05.html">Add Translate Method to Vector - Demo 05</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch06.html">Modelspace - Demo 06</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch07.html">Rotations - Demo 07</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch08.html">Rotation Fix Attempt 1 - Demo 08</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch09.html">Rotation Fixed - Sequence of Transformations - Demo 09</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch10.html">Camera Space - Demo 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch11.html">Relative Objects - Demo 11</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch12.html">Rotate the Square - Demo 12</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch13.html">Rotate the Square Around Paddle 1 - Demo 13</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch14.html">Adding Depth - Z axis Demo 14</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch15.html">Adding Depth - Enable Depth Buffer - Demo 15</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Lambda Stack - Demo 16</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch17.html">Moving Camera in 3D Space - Demo 17</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch18.html">3D Perspective - Demo 18</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch19.html">Matrix Stacks - Demo 19</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch20.html">Shaders - Demo 20</a></li>
<li class="toctree-l1"><a class="reference internal" href="ch21.html">OpenGL3.3 Core Profile - Demo 21</a></li>
<li class="toctree-l1"><a class="reference internal" href="perspective.html">Standard Perspective Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="miscellany.html">Miscellany</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="sources/ch16.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="lambda-stack-demo-16">
<h1>Lambda Stack - Demo 16<a class="headerlink" href="#lambda-stack-demo-16" title="Link to this heading">¶</a></h1>
<section id="objective">
<h2>Objective<a class="headerlink" href="#objective" title="Link to this heading">¶</a></h2>
<p>Remove repetition in the coordinate transformations,
as previous demos had very similar transformations,
especially from camera space to NDC space.
Each edge of the graph of objects
should only be specified once per frame.</p>
<figure class="align-center" id="id1">
<img alt="Demo 12" class="no-scale" src="images/demo18-1.png" />
<figcaption>
<p><span class="caption-text">Full Cayley graph.</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Noticing in the previous demos that the lower parts of the transformations
have a common pattern, we can create a stack of functions for later application.
Before drawing geometry, we add any functions to the top of the stack,
apply all of our functions in the stack to our <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> data to
get NDC data,
and before we return to the parent
node, we pop the functions we added off of the stack, to ensure that
we return the stack to the state that the parent node gave us.</p>
<p>To explain in more detail —</p>
<p>What’s the difference between drawing paddle 1 and the square?</p>
<p>Here is paddle 1 code</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo14.py</span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">208</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glColor3f</span><span class="p">(</span><span class="o">*</span><span class="nb">iter</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>
<span class="linenos">209</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">210</span>    <span class="k">for</span> <span class="n">p1_v_ms</span> <span class="ow">in</span> <span class="n">paddle1</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<span class="linenos">211</span>        <span class="n">ms_to_ndc</span><span class="p">:</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">InvertibleFunction</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">212</span>            <span class="p">[</span>
<span class="linenos">213</span>                <span class="c1"># camera space to NDC</span>
<span class="linenos">214</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">uniform_scale</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">),</span>
<span class="linenos">215</span>                <span class="c1"># world space to camera space</span>
<span class="linenos">216</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">position_ws</span><span class="p">)),</span>
<span class="linenos">217</span>                <span class="c1"># model space to world space</span>
<span class="linenos">218</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">219</span>                    <span class="p">[</span>
<span class="linenos">220</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="p">),</span>
<span class="linenos">221</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">rotation</span><span class="p">),</span>
<span class="linenos">222</span>                    <span class="p">]</span>
<span class="linenos">223</span>                <span class="p">),</span>
<span class="linenos">224</span>            <span class="p">]</span>
<span class="linenos">225</span>        <span class="p">)</span>
<span class="linenos">226</span>
<span class="linenos">227</span>        <span class="n">paddle1_vector_ndc</span><span class="p">:</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">Vector3D</span> <span class="o">=</span> <span class="n">ms_to_ndc</span><span class="p">(</span><span class="n">p1_v_ms</span><span class="p">)</span>
<span class="linenos">228</span>        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span>
<span class="linenos">229</span>            <span class="n">paddle1_vector_ndc</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">paddle1_vector_ndc</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">paddle1_vector_ndc</span><span class="o">.</span><span class="n">z</span>
<span class="linenos">230</span>        <span class="p">)</span>
<span class="linenos">231</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Here is the square’s code:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo14.py</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">235</span>    <span class="c1"># draw square</span>
<span class="linenos">236</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glColor3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="linenos">237</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">238</span>    <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">square</span><span class="p">:</span>
<span class="linenos">239</span>        <span class="n">ms_to_ndc</span><span class="p">:</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">InvertibleFunction</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">240</span>            <span class="p">[</span>
<span class="linenos">241</span>                <span class="c1"># camera space to NDC</span>
<span class="linenos">242</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">uniform_scale</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">),</span>
<span class="linenos">243</span>                <span class="c1"># world space to camera space</span>
<span class="linenos">244</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">position_ws</span><span class="p">)),</span>
<span class="linenos">245</span>                <span class="c1"># model space to world space</span>
<span class="linenos">246</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">247</span>                    <span class="p">[</span>
<span class="linenos">248</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="p">),</span>
<span class="linenos">249</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">rotation</span><span class="p">),</span>
<span class="linenos">250</span>                    <span class="p">]</span>
<span class="linenos">251</span>                <span class="p">),</span>
<span class="linenos">252</span>                <span class="c1"># square space to paddle 1 space</span>
<span class="linenos">253</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">254</span>                    <span class="p">[</span>
<span class="linenos">255</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)),</span>
<span class="linenos">256</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">rotation_around_paddle1</span><span class="p">),</span>
<span class="linenos">257</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)),</span>
<span class="linenos">258</span>                        <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">square_rotation</span><span class="p">),</span>
<span class="linenos">259</span>                    <span class="p">]</span>
<span class="linenos">260</span>                <span class="p">),</span>
<span class="linenos">261</span>            <span class="p">]</span>
<span class="linenos">262</span>        <span class="p">)</span>
<span class="linenos">263</span>        <span class="n">square_vector_ndc</span><span class="p">:</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">Vector3D</span> <span class="o">=</span> <span class="n">ms_to_ndc</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
<span class="linenos">264</span>        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span>
<span class="linenos">265</span>            <span class="n">square_vector_ndc</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">square_vector_ndc</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">square_vector_ndc</span><span class="o">.</span><span class="n">z</span>
<span class="linenos">266</span>        <span class="p">)</span>
<span class="linenos">267</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The only difference is the square’s <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> to paddle1 space.  Everything else is exactly the same.
In a graphics program, because the scene is a hierarchy of relative
objects, it is unwise to put this much repetition in the transformation
sequence.  Especially if we might change how the camera operates,
or from perspective to ortho.  It would required a lot of code changes.
And I don’t like reading from the bottom of the code up.  Code doesn’t
execute that way.  I want to read from top to bottom.</p>
<p>When reading the transformation sequences in the previous demos from top down
the transformation at the top is applied first, the transformation
at the bottom is applied last, with the intermediate results method-chained together.
(look up above for a reminder)</p>
<p>With a function stack, the function at the top of the stack (f5) is applied first,
the result of this is then given as input to f4 (second on the stack), all
the way down to f1, which was the first fn to be placed on the stack,
and as such, the last to be applied. (Last In First Applied - LIFA)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>             <span class="o">|-------------------|</span>
<span class="p">(</span><span class="n">MODELSPACE</span><span class="p">)</span> <span class="o">|</span>                   <span class="o">|</span>
  <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="o">-&gt;</span>  <span class="o">|</span>       <span class="n">f5</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f4</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f3</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f2</span>          <span class="o">|--</span>
             <span class="o">|-------------------|</span> <span class="o">|</span>
                                   <span class="o">|</span>
          <span class="o">-------------------------</span>
          <span class="o">|</span>
          <span class="o">|</span>  <span class="o">|-------------------|</span>
          <span class="o">|</span>  <span class="o">|</span>                   <span class="o">|</span>
           <span class="o">-&gt;|</span>       <span class="n">f1</span>          <span class="o">|--&gt;</span>  <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="n">NDC</span>
             <span class="o">|-------------------|</span>
</pre></div>
</div>
<p>So, in order to ensure that the functions in a stack will execute
in the same order as all of the previous demos, they need to be
pushed onto the stack in reverse order.</p>
<p>This means that from <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> to world space, we can now
read the transformations FROM TOP TO BOTTOM!!!!  SUCCESS!</p>
<p>Then, to draw the square relative to paddle one, those six
transformations will already be on the stack, therefore
only push the differences, and then apply the stack to
the paddle’s <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> data.</p>
</section>
<section id="how-to-execute">
<h2>How to Execute<a class="headerlink" href="#how-to-execute" title="Link to this heading">¶</a></h2>
<p>Load src/modelviewprojection/demo16.py in Spyder and hit the play button.</p>
</section>
<section id="move-the-paddles-using-the-keyboard">
<h2>Move the Paddles using the Keyboard<a class="headerlink" href="#move-the-paddles-using-the-keyboard" title="Link to this heading">¶</a></h2>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Keyboard Input</p></th>
<th class="head"><p>Action</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><em>w</em></p></td>
<td><p>Move Left Paddle Up</p></td>
</tr>
<tr class="row-odd"><td><p><em>s</em></p></td>
<td><p>Move Left Paddle Down</p></td>
</tr>
<tr class="row-even"><td><p><em>k</em></p></td>
<td><p>Move Right Paddle Down</p></td>
</tr>
<tr class="row-odd"><td><p><em>i</em></p></td>
<td><p>Move Right Paddle Up</p></td>
</tr>
<tr class="row-even"><td><p><em>d</em></p></td>
<td><p>Increase Left Paddle’s Rotation</p></td>
</tr>
<tr class="row-odd"><td><p><em>a</em></p></td>
<td><p>Decrease Left Paddle’s Rotation</p></td>
</tr>
<tr class="row-even"><td><p><em>l</em></p></td>
<td><p>Increase Right Paddle’s Rotation</p></td>
</tr>
<tr class="row-odd"><td><p><em>j</em></p></td>
<td><p>Decrease Right Paddle’s Rotation</p></td>
</tr>
<tr class="row-even"><td><p><em>UP</em></p></td>
<td><p>Move the camera up, moving the objects down</p></td>
</tr>
<tr class="row-odd"><td><p><em>DOWN</em></p></td>
<td><p>Move the camera down, moving the objects up</p></td>
</tr>
<tr class="row-even"><td><p><em>LEFT</em></p></td>
<td><p>Move the camera left, moving the objects right</p></td>
</tr>
<tr class="row-odd"><td><p><em>RIGHT</em></p></td>
<td><p>Move the camera right, moving the objects left</p></td>
</tr>
<tr class="row-even"><td><p><em>q</em></p></td>
<td><p>Rotate the square around its center</p></td>
</tr>
<tr class="row-odd"><td><p><em>e</em></p></td>
<td><p>Rotate the square around paddle 1’s center</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Function stack.  Internally it has a list, where index 0 is
the bottom of the stack.  In python we can store any object
as a variable, and we will be storing functions which transform
a vector to another vector, through the “modelspace_to_ndc” method.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/mathutils3d</span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">270</span><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="linenos">271</span><span class="k">class</span> <span class="nc">FunctionStack</span><span class="p">:</span>
<span class="linenos">272</span>    <span class="n">stack</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">mu</span><span class="o">.</span><span class="n">InvertibleFunction</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
<span class="linenos">273</span>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[]</span>
<span class="linenos">274</span>    <span class="p">)</span>
<span class="linenos">275</span>
<span class="linenos">276</span>    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="n">mu</span><span class="o">.</span><span class="n">InvertibleFunction</span><span class="p">):</span>
<span class="linenos">277</span>        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos">278</span>
<span class="linenos">279</span>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mu</span><span class="o">.</span><span class="n">InvertibleFunction</span><span class="p">:</span>
<span class="linenos">280</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos">281</span>
<span class="linenos">282</span>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">283</span>        <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="linenos">284</span>
<span class="linenos">285</span>    <span class="k">def</span> <span class="nf">modelspace_to_ndc_fn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mu</span><span class="o">.</span><span class="n">InvertibleFunction</span><span class="p">:</span>
<span class="linenos">286</span>        <span class="k">return</span> <span class="n">mu</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">)</span>
<span class="linenos">287</span>
<span class="linenos">288</span>
<span class="linenos">289</span><span class="n">fn_stack</span> <span class="o">=</span> <span class="n">FunctionStack</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Define four functions, which we will compose on the stack.</p>
<p>Push identity onto the stack, which will will never pop off of the stack.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">tests/test_mathutils3d.py</span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">162</span><span class="k">def</span> <span class="nf">test_fn_stack</span><span class="p">():</span>
<span class="linenos">163</span>    <span class="n">identity</span><span class="p">:</span> <span class="n">InvertibleFunction</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">uniform_scale</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">164</span>
<span class="linenos">165</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span>
<span class="linenos">166</span>    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">167</span>
<span class="linenos">168</span>    <span class="n">add_one</span><span class="p">:</span> <span class="n">InvertibleFunction</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">169</span>
<span class="linenos">170</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">add_one</span><span class="p">)</span>
<span class="linenos">171</span>    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># x + 1 = 2</span>
<span class="linenos">172</span>
<span class="linenos">173</span>    <span class="n">multiply_by_2</span><span class="p">:</span> <span class="n">InvertibleFunction</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">uniform_scale</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">174</span>
<span class="linenos">175</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">multiply_by_2</span><span class="p">)</span>  <span class="c1"># (x * 2) + 1 = 3</span>
<span class="linenos">176</span>    <span class="k">assert</span> <span class="mi">3</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">177</span>
<span class="linenos">178</span>    <span class="n">add_5</span><span class="p">:</span> <span class="n">InvertibleFunction</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="linenos">179</span>
<span class="linenos">180</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">add_5</span><span class="p">)</span>  <span class="c1"># ((x + 5) * 2) + 1 = 13</span>
<span class="linenos">181</span>    <span class="k">assert</span> <span class="mi">13</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">182</span>
<span class="linenos">183</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos">184</span>    <span class="k">assert</span> <span class="mi">3</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (x * 2) + 1 = 3</span>
<span class="linenos">185</span>
<span class="linenos">186</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos">187</span>    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># x + 1 = 2</span>
<span class="linenos">188</span>
<span class="linenos">189</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos">190</span>    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># x = 1</span>
</pre></div>
</div>
</div>
</section>
<section id="event-loop">
<h2>Event Loop<a class="headerlink" href="#event-loop" title="Link to this heading">¶</a></h2>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">188</span><span class="k">while</span> <span class="ow">not</span> <span class="n">glfw</span><span class="o">.</span><span class="n">window_should_close</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
</pre></div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
</pre></div>
</div>
<p>In previous demos, camera_space_to_ndc_space_fn was always
the last function called in the method chained pipeline.  Put it on the bottom of the stack,
by pushing it first,
so that “modelspace_to_ndc” calls this function last.  Each subsequent push will add
a new function to the top of the stack.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{f}_{c}^{ndc}\]</div>
</div>
<figure class="align-center">
<img alt="Demo 12" class="no-scale" src="images/demo18-2.png" />
</figure>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">208</span>    <span class="c1"># camera space to NDC</span>
<span class="linenos">209</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">uniform_scale</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Unlike in previous demos in which we read the transformations
from <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> to world space backwards; this time because the transformations
are on a stack, the fns on the model stack can
be read forwards, where each operation translates/rotates/scales
the current space</p>
<p>The camera’s position and orientation are defined relative
to world space like so, read top to bottom:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{f}_{c}^{w}\]</div>
</div>
<figure class="align-center">
<img alt="Demo 12" class="no-scale" src="images/demo18-3.png" />
</figure>
<p>But, since we need to transform world-space to camera space,
they must be inverted by reversing the order, and negating
the arguments</p>
<p>Therefore the transformations to put the world space into
camera space are.</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{f}_{w}^{c}\]</div>
</div>
<figure class="align-center">
<img alt="Demo 12" class="no-scale" src="images/demo18-7.png" />
</figure>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">213</span>    <span class="c1"># world space to camera space</span>
<span class="linenos">214</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">position_ws</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<section id="draw-paddle-1">
<h3>draw paddle 1<a class="headerlink" href="#draw-paddle-1" title="Link to this heading">¶</a></h3>
<p>Unlike in previous demos in which we read the transformations
from <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> to world space backwards; because the transformations
are on a stack, the fns on the model stack can
be read forwards, where each operation translates/rotates/scales
the current space</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{f}_{p1}^{w}\]</div>
</div>
<figure class="align-center">
<img alt="Demo 12" class="no-scale" src="images/demo18-4.png" />
</figure>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">218</span>    <span class="c1"># paddle 1 model space to world space</span>
<span class="linenos">219</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
<span class="linenos">220</span>        <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">221</span>            <span class="p">[</span><span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">position</span><span class="p">),</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">rotation</span><span class="p">)]</span>
<span class="linenos">222</span>        <span class="p">)</span>
<span class="linenos">223</span>    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>for each of the <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> coordinates, apply all
of the procedures on the stack from top to bottom
this results in coordinate data in NDC space,
which we can pass to glVertex3f</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">227</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glColor3f</span><span class="p">(</span><span class="o">*</span><span class="nb">iter</span><span class="p">(</span><span class="n">paddle1</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>
<span class="linenos">228</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">229</span>    <span class="k">for</span> <span class="n">p1_v_ms</span> <span class="ow">in</span> <span class="n">paddle1</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<span class="linenos">230</span>        <span class="n">paddle1_vector_ndc</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="n">p1_v_ms</span><span class="p">)</span>
<span class="linenos">231</span>        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span>
<span class="linenos">232</span>            <span class="n">paddle1_vector_ndc</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
<span class="linenos">233</span>            <span class="n">paddle1_vector_ndc</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
<span class="linenos">234</span>            <span class="n">paddle1_vector_ndc</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
<span class="linenos">235</span>        <span class="p">)</span>
<span class="linenos">236</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="draw-the-square">
<h3>draw the square<a class="headerlink" href="#draw-the-square" title="Link to this heading">¶</a></h3>
<p>since the modelstack is already in paddle1’s space,
and since the blue square is defined relative to paddle1,
just add the transformations relative to it
before the blue square is drawn.  Draw the square, and then
remove these 4 transformations from the stack (done below)</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{f}_{s}^{p1}\]</div>
</div>
<figure class="align-center">
<img alt="Demo 12" class="no-scale" src="images/demo18-5.png" />
</figure>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id11" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">240</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
<span class="linenos">241</span>        <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">242</span>            <span class="p">[</span>
<span class="linenos">243</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">)),</span>
<span class="linenos">244</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">rotation_around_paddle1</span><span class="p">),</span>
<span class="linenos">245</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">mu3d</span><span class="o">.</span><span class="n">Vector3D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)),</span>
<span class="linenos">246</span>                <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">square_rotation</span><span class="p">),</span>
<span class="linenos">247</span>            <span class="p">]</span>
<span class="linenos">248</span>        <span class="p">)</span>
<span class="linenos">249</span>    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id12" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">252</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glColor3f</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="linenos">253</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">254</span>    <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">square</span><span class="p">:</span>
<span class="linenos">255</span>        <span class="n">square_vector_ndc</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="n">ms</span><span class="p">)</span>
<span class="linenos">256</span>        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span>
<span class="linenos">257</span>            <span class="n">square_vector_ndc</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
<span class="linenos">258</span>            <span class="n">square_vector_ndc</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
<span class="linenos">259</span>            <span class="n">square_vector_ndc</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
<span class="linenos">260</span>        <span class="p">)</span>
<span class="linenos">261</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now we need to remove fns from the stack so that the
lambda stack will convert from world space to NDC.
This will allow us to just add the transformations from
world space to paddle2 space on the stack.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id13" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">265</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># pop off square space to paddle 1 space</span>
<span class="linenos">266</span>    <span class="c1"># current space is paddle 1 space</span>
<span class="linenos">267</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># # pop off paddle 1 model space to world space</span>
<span class="linenos">268</span>    <span class="c1"># current space is world space</span>
</pre></div>
</div>
</div>
<p>since paddle2’s <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> is independent of paddle 1’s space, only
leave the view and projection fns (1) - (4)</p>
</section>
<section id="draw-paddle-2">
<h3>draw paddle 2<a class="headerlink" href="#draw-paddle-2" title="Link to this heading">¶</a></h3>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\vec{f}_{p2}^{w}\]</div>
</div>
<figure class="align-center">
<img alt="Demo 12" class="no-scale" src="images/demo18-6.png" />
</figure>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id14" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">272</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
<span class="linenos">273</span>        <span class="n">mu3d</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span>
<span class="linenos">274</span>            <span class="p">[</span><span class="n">mu3d</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">paddle2</span><span class="o">.</span><span class="n">position</span><span class="p">),</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">rotate_z</span><span class="p">(</span><span class="n">paddle2</span><span class="o">.</span><span class="n">rotation</span><span class="p">)]</span>
<span class="linenos">275</span>        <span class="p">)</span>
<span class="linenos">276</span>    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id15" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">280</span>    <span class="c1"># draw paddle 2</span>
<span class="linenos">281</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glColor3f</span><span class="p">(</span><span class="o">*</span><span class="nb">iter</span><span class="p">(</span><span class="n">paddle2</span><span class="o">.</span><span class="n">color</span><span class="p">))</span>
<span class="linenos">282</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glBegin</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_QUADS</span><span class="p">)</span>
<span class="linenos">283</span>    <span class="k">for</span> <span class="n">p2_v_ms</span> <span class="ow">in</span> <span class="n">paddle2</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
<span class="linenos">284</span>        <span class="n">paddle2_vector_ndc</span> <span class="o">=</span> <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">modelspace_to_ndc_fn</span><span class="p">()(</span><span class="n">p2_v_ms</span><span class="p">)</span>
<span class="linenos">285</span>        <span class="n">GL</span><span class="o">.</span><span class="n">glVertex3f</span><span class="p">(</span>
<span class="linenos">286</span>            <span class="n">paddle2_vector_ndc</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
<span class="linenos">287</span>            <span class="n">paddle2_vector_ndc</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
<span class="linenos">288</span>            <span class="n">paddle2_vector_ndc</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
<span class="linenos">289</span>        <span class="p">)</span>
<span class="linenos">290</span>    <span class="n">GL</span><span class="o">.</span><span class="n">glEnd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>remove all fns from the function stack, as the next frame will set them
clear makes the list empty, as the list (stack) will be repopulated
the next iteration of the event loop.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id16" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">294</span>    <span class="c1"># done rendering everything for this frame, just go ahead and clear all functions</span>
<span class="linenos">295</span>    <span class="c1"># off of the stack, back to NDC as current space</span>
<span class="linenos">296</span>    <span class="n">mu3d</span><span class="o">.</span><span class="n">fn_stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="linenos">297</span>
</pre></div>
</div>
</div>
<p>Swap buffers and execute another iteration of the event loop</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">src/modelviewprojection/demo16.py</span><a class="headerlink" href="#id17" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">301</span>    <span class="n">glfw</span><span class="o">.</span><span class="n">swap_buffers</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Notice in the above code, adding functions to the stack is creating a shared
context for transformations, and before we call “glVertex3f”, we always call
“modelspace_to_ndc” on the <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> vector.  In Demo 19, we will be using
OpenGL 2.1 matrix stacks.  Although we don’t have the code for the OpenGL
driver, given that you’ll see that we pass <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a> data directly to “glVertex3f”,
it should be clear that the OpenGL implementation must fetch the <a class="reference internal" href="glossary.html#term-Modelspace"><span class="xref std std-term">modelspace</span></a>
to NDC transformations from the ModelView and Projection matrix stacks.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="ch17.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Moving Camera in 3D Space - Demo 17</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="ch15.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Adding Depth - Enable Depth Buffer - Demo 15</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020-2025, William Emerison Six
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Lambda Stack - Demo 16</a><ul>
<li><a class="reference internal" href="#objective">Objective</a></li>
<li><a class="reference internal" href="#how-to-execute">How to Execute</a></li>
<li><a class="reference internal" href="#move-the-paddles-using-the-keyboard">Move the Paddles using the Keyboard</a></li>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#event-loop">Event Loop</a><ul>
<li><a class="reference internal" href="#draw-paddle-1">draw paddle 1</a></li>
<li><a class="reference internal" href="#draw-the-square">draw the square</a></li>
<li><a class="reference internal" href="#draw-paddle-2">draw paddle 2</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="static/documentation_options.js?v=e3a6060d"></script>
    <script src="static/doctools.js?v=9bcbadda"></script>
    <script src="static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="static/scripts/furo.js?v=46bd48cc"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]]}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>